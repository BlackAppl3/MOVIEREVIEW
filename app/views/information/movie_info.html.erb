<script>
    function clickfunction(movieno){
        var opt = document.getElementById("rating").value
        var movieno = document.getElementById("hidden-para").innerHTML
        console.log(movieno)
        
        /* const urlParams = new URLSearchParams(window.location.search);
        # const myParam = urlParams.get("");
        # console.log(myParam) */
        
       window.location.href = "/information/movie_info/"+movieno+"?filter=true&rating_val="+opt+""; 


    }
</script>

<% content_for(:title, "Hey Root") %>

<% if @rating == 0 %>
    <p> No ratings for this movie </p>
<% else %>
    <p> THIS MOVIE GOT <%= pluralize(@result, 'rating') %> </p>
<% end %>        

<marquee> All Reviews. Hey root you can also warn and ban the users who does bad comment  :) </marquee>

<center> <%= link_to("Highest rating first", {
    "controller": "information",
    "action": "movie_info",
    "id": params[:id],
    "order": "high"
}, class: "btn btn-success") %>  <%= link_to("Lowest rating first", {
    "controller": "information",
    "action": "movie_info",
    "id": params[:id],
    "order": "low"
}, class: "btn btn-success") %> 
     <%= select_tag "rating", options_for_select([["1-STAR", "1"], ["2-STAR", "2"], ["3-STAR", "3"], ["4-STAR", "4"], ["5-STAR", "5"]]), class: "btn btn-success", :onclick => "clickfunction()" %> 
</center>

<p id = "hidden-para" hidden> <%= params[:id] %> </p>


<table class = "table table-striped" >
   <thead>
      <tr>
         <th scope="col" > Comment </td>
         <th scope="col" > Rating </td>
         <th scope="col" > Ban the user </td>
         <th scope="col" > Warn the user </td>
         <th scope="col" > Warning Count </td>
      </tr>
   </thead>
   <tbody>
     <% @res.each do |f| %>
         <tr scope = "row" >
            <td> <%= f.comment  %> </td>
            <td> <%= f.rating %> </td>
            <td> <%= 
                temp = User.find_by(email: f.email) 
                if  temp && temp.ban
                    "You have already banned the user"
                else
                    link_to('Ban the wrong one', {
                         "controller": "information",
                         "action": "ban_user",
                         "id": "1",
                         "email": f.email,
                         "info_id": f.id
                    })     
                end %> </td>
            <td> <%= 
                temp = User.find_by(email: f.email) 
                if  temp && temp.ban
                    "You have already banned the user"
                else
                 link_to('Warn the user', {
                      "controller": "information",
                      "action": "warn_user",
                      "email": f.email
                 }) 
                end 
                %>
            </td>
            <td> <%= if User.find_by(email: f.email) && User.find_by(email: f.email).warning_count != nil
                         User.find_by(email: f.email).warning_count 
                      else
                         0   
                      end   
                 %> </td>
         </tr>
     <% end %>
   </tbody>  
</table>     